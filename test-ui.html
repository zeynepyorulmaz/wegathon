<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIKU Travel Planner - Test UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emoji {
            font-size: 24px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            color: #666;
            font-size: 14px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .result.active {
            display: block;
        }

        .result h3 {
            color: #333;
            margin-bottom: 16px;
            font-size: 18px;
        }

        .time-slot {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
        }

        .time-slot-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-badge {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }

        .options {
            display: grid;
            gap: 8px;
        }

        .option {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option-text {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .option-desc {
            font-size: 13px;
            color: #666;
        }

        .error {
            background: #fee;
            border-left: 4px solid #f44;
            padding: 12px;
            border-radius: 6px;
            color: #c33;
            margin-bottom: 16px;
        }

        .success {
            background: #efe;
            border-left: 4px solid #4a4;
            padding: 12px;
            border-radius: 6px;
            color: #373;
            margin-bottom: 16px;
        }

        .json-view {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.5;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-button {
            background: #e0e0e0;
            color: #666;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            width: auto;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç AIKU Travel Planner - Test UI</h1>
            <p class="subtitle">Backend API Test Interface</p>
        </header>

        <div class="grid">
            <!-- Conversational Chat -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2><span class="emoji">üí¨</span> Conversational Travel Planning</h2>
                <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                    AI will ask questions to collect all trip details, then create your perfect plan!
                </p>
                <div class="input-group">
                    <label>Start Your Trip Planning</label>
                    <textarea id="chatPrompt" placeholder="Berlin'e gitmek istiyorum"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="input-group">
                        <label>Language</label>
                        <select id="chatLanguage">
                            <option value="tr">Turkish</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Currency</label>
                        <select id="chatCurrency">
                            <option value="TRY">TRY</option>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                        </select>
                    </div>
                </div>
                <button onclick="startChat()" id="chatStartBtn">üöÄ Start Chat & Get Plan</button>
                
                <!-- Chat Continuation -->
                <div id="chatContinueSection" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <div class="input-group">
                        <label>Revise Plan (e.g., "2. g√ºn√º daha rahat yap")</label>
                        <textarea id="chatContinueMsg" placeholder="2. g√ºn√º daha rahat yap"></textarea>
                    </div>
                    <button onclick="continueChat()">‚úèÔ∏è Revise Plan</button>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Bookings API -->
            <div class="card">
                <h2><span class="emoji">‚úàÔ∏è</span> Bookings API (Parallel)</h2>
                <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                    Flight + Hotel search in parallel - super fast!
                </p>
                <div class="input-group">
                    <label>Origin</label>
                    <input type="text" id="bookingOrigin" placeholder="Istanbul">
                </div>
                <div class="input-group">
                    <label>Destination</label>
                    <input type="text" id="bookingDestination" placeholder="Berlin">
                </div>
                <div class="input-group">
                    <label>Start Date</label>
                    <input type="date" id="bookingStartDate">
                </div>
                <div class="input-group">
                    <label>End Date</label>
                    <input type="date" id="bookingEndDate">
                </div>
                <div class="input-group">
                    <label>Adults</label>
                    <input type="number" id="bookingAdults" value="2">
                </div>
                <button onclick="testBookings()">üîç Search Bookings (Parallel)</button>
            </div>

            <!-- Activities API -->
            <div class="card">
                <h2><span class="emoji">üó∫Ô∏è</span> Activities API</h2>
                <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                    AI-generated day-by-day itinerary
                </p>
                <div class="input-group">
                    <label>Destination</label>
                    <input type="text" id="activityDestination" placeholder="Berlin">
                </div>
                <div class="input-group">
                    <label>Start Date</label>
                    <input type="date" id="activityStartDate">
                </div>
                <div class="input-group">
                    <label>End Date</label>
                    <input type="date" id="activityEndDate">
                </div>
                <div class="input-group">
                    <label>Preferences (comma-separated)</label>
                    <input type="text" id="activityPreferences" placeholder="museums, food, culture">
                </div>
                <button onclick="testActivities()">üìÖ Plan Activities</button>
            </div>
        </div>

        <!-- Interactive Plan (for frontend testing) -->
        <div class="card">
            <h2><span class="emoji">üéØ</span> Interactive Plan (Frontend Format)</h2>
            <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                Get plan with multiple options per time slot - perfect for frontend!
            </p>
            <div class="input-group">
                <label>Travel Prompt</label>
                <textarea id="interactivePrompt" placeholder="ƒ∞stanbul Berlin 3 g√ºn 2 ki≈üi"></textarea>
            </div>
            <div class="input-group">
                <label>Language</label>
                <select id="interactiveLanguage">
                    <option value="tr">Turkish</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="input-group">
                <label>Currency</label>
                <select id="interactiveCurrency">
                    <option value="TRY">TRY</option>
                    <option value="EUR">EUR</option>
                    <option value="USD">USD</option>
                </select>
            </div>
            <button onclick="testInteractivePlan()">Generate Interactive Plan</button>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Plan olu≈üturuluyor... (Bu 30-60 saniye s√ºrebilir)</p>
        </div>

        <!-- Results -->
        <div class="result" id="result">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('ui')">üì± UI View</button>
                <button class="tab-button" onclick="switchTab('json')">üìÑ JSON View</button>
            </div>

            <div id="tab-ui" class="tab-content active">
                <div id="uiContent"></div>
            </div>

            <div id="tab-json" class="tab-content">
                <pre id="jsonContent" class="json-view"></pre>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:4000/api';

        let currentTab = 'ui';
        let currentSessionId = null;

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        async function startChat() {
            const prompt = document.getElementById('chatPrompt').value;
            const language = document.getElementById('chatLanguage').value;
            const currency = document.getElementById('chatCurrency').value;

            if (!prompt) {
                alert('L√ºtfen bir mesaj girin!');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/chat/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        initial_message: prompt, 
                        language, 
                        currency 
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'API error');
                }

                // Store session ID
                currentSessionId = data.session_id;

                // Show chat continuation section
                document.getElementById('chatContinueSection').style.display = 'block';
                
                // Display chat response
                displayChatResponse(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        async function continueChat() {
            if (!currentSessionId) {
                alert('√ñnce bir chat ba≈ülatƒ±n!');
                return;
            }

            const message = document.getElementById('chatContinueMsg').value;

            if (!message) {
                alert('L√ºtfen bir mesaj girin!');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/chat/continue`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        session_id: currentSessionId, 
                        message 
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'API error');
                }

                // Clear continue message
                document.getElementById('chatContinueMsg').value = '';
                
                // Display updated plan
                displayChatResponse(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        function displayChatResponse(data) {
            const uiContent = document.getElementById('uiContent');
            
            let html = '';
            
            // Always show AI message
            html += `
                <div style="background: #667eea; color: white; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">üí¨ AI Assistant</div>
                    <div style="white-space: pre-wrap; line-height: 1.6;">${data.message}</div>
                </div>
            `;
            
            // Show collected data
            if (data.collected_data && Object.keys(data.collected_data).length > 0) {
                html += `
                    <div style="background: #e8f5e9; padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                        <strong style="color: #2e7d32;">‚úì Toplanan Bilgiler:</strong><br><br>
                `;
                
                if (data.collected_data.destination) html += `üìç <strong>Destinasyon:</strong> ${data.collected_data.destination}<br>`;
                if (data.collected_data.origin) html += `üè† <strong>Nereden:</strong> ${data.collected_data.origin}<br>`;
                if (data.collected_data.start_date) html += `üìÖ <strong>Ba≈ülangƒ±√ß:</strong> ${data.collected_data.start_date}<br>`;
                if (data.collected_data.end_date) html += `üìÖ <strong>Biti≈ü:</strong> ${data.collected_data.end_date}<br>`;
                if (data.collected_data.adults) html += `üë• <strong>Yeti≈ükin:</strong> ${data.collected_data.adults}<br>`;
                if (data.collected_data.children) html += `üë∂ <strong>√áocuk:</strong> ${data.collected_data.children}<br>`;
                if (data.collected_data.preferences && data.collected_data.preferences.length > 0) {
                    html += `üéØ <strong>Tercihler:</strong> ${data.collected_data.preferences.join(', ')}<br>`;
                }
                
                html += `</div>`;
            }
            
            // Show missing info if still collecting
            if (data.needs_more_info) {
                html += `
                    <div style="background: #fff3e0; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                        <strong style="color: #e65100;">‚è≥ Eksik Bilgiler:</strong> AI sorularƒ± yanƒ±tlayƒ±n...
                    </div>
                `;
            }
            
            // Show plan if available
            if (data.plan) {
                html += `
                    <div class="success">‚úÖ Plan Olu≈üturuldu!</div>
                `;
                
                // Use existing plan display
                displaySimplePlan(data.plan);
                const planHtml = document.getElementById('uiContent').innerHTML;
                html += planHtml;
            }
            
            // Show session info
            html += `
                <div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin-top: 20px; font-size: 12px; color: #666;">
                    <strong>Session:</strong> ${data.session_id.substring(0, 8)}... | 
                    <strong>Status:</strong> ${data.conversation_complete ? '‚úÖ Complete' : data.needs_more_info ? '‚è≥ Collecting Info' : 'üìù Ready'}
                </div>
            `;
            
            uiContent.innerHTML = html;
            document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
            showResult();
        }

        async function testBookings() {
            const origin = document.getElementById('bookingOrigin').value || 'Istanbul';
            const destination = document.getElementById('bookingDestination').value;
            const startDate = document.getElementById('bookingStartDate').value;
            const endDate = document.getElementById('bookingEndDate').value;
            const adults = parseInt(document.getElementById('bookingAdults').value) || 2;

            if (!destination || !startDate || !endDate) {
                alert('L√ºtfen t√ºm alanlarƒ± doldurun!');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        origin,
                        destination,
                        start_date: startDate,
                        end_date: endDate,
                        adults
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'API error');
                }

                displayBookingsResult(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        async function testActivities() {
            const destination = document.getElementById('activityDestination').value;
            const startDate = document.getElementById('activityStartDate').value;
            const endDate = document.getElementById('activityEndDate').value;
            const preferencesStr = document.getElementById('activityPreferences').value;
            const preferences = preferencesStr ? preferencesStr.split(',').map(s => s.trim()) : [];

            if (!destination || !startDate || !endDate) {
                alert('L√ºtfen t√ºm alanlarƒ± doldurun!');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/activities`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        destination,
                        start_date: startDate,
                        end_date: endDate,
                        adults: 2,
                        preferences,
                        budget: 'mid',
                        language: 'tr'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'API error');
                }

                displayActivitiesResult(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        function displayBookingsResult(data) {
            const uiContent = document.getElementById('uiContent');
            
            let html = `
                <div class="success">‚úÖ Booking Results (Parallel Search Complete!)</div>
                
                <h3>üí∞ Pricing Estimate</h3>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${data.pricing?.flights || 0}</div>
                        <div class="stat-label">Flights (${data.pricing?.currency})</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.pricing?.hotels || 0}</div>
                        <div class="stat-label">Hotels (${data.pricing?.currency})</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.pricing?.total || 0}</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.pricing?.per_person || 0}</div>
                        <div class="stat-label">Per Person</div>
                    </div>
                </div>
            `;

            // Flights
            if (data.flights?.outbound) {
                const flight = data.flights.outbound;
                html += `
                    <h3>‚úàÔ∏è Selected Flight</h3>
                    <div class="time-slot">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>${flight.airline} ${flight.flightNumber || ''}</strong><br>
                                <span style="color: #666;">${flight.origin || flight.fromIata} ‚Üí ${flight.destination || flight.toIata}</span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 20px; font-weight: 700; color: #667eea;">
                                    ${flight.price || 0} ${flight.currency}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Hotels
            if (data.hotels?.selected) {
                const hotel = data.hotels.selected;
                html += `
                    <h3>üè® Selected Hotel</h3>
                    <div class="time-slot">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>${hotel.name || 'Hotel'}</strong><br>
                                <span style="color: #666;">${hotel.location || ''}</span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 20px; font-weight: 700; color: #667eea;">
                                    ${hotel.priceTotal || 0} ${hotel.currency}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            uiContent.innerHTML = html;
            document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
            showResult();
        }

        function displayActivitiesResult(data) {
            const uiContent = document.getElementById('uiContent');
            
            let html = `
                <div class="success">‚úÖ Activities Plan Generated!</div>
                
                <h3>üìù Summary</h3>
                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    ${data.summary || 'Activity plan created'}
                </div>
            `;

            if (data.days && data.days.length > 0) {
                html += `<h3>üìÖ Daily Itinerary</h3>`;
                
                data.days.forEach(day => {
                    html += `
                        <div class="time-slot">
                            <div class="time-slot-header">
                                <span>Day ${day.day}: ${day.title || ''}</span>
                                <span class="day-badge">${day.dateISO || ''}</span>
                            </div>
                            <div style="color: #666; margin-bottom: 12px;">${day.description || ''}</div>
                    `;
                    
                    if (day.blocks) {
                        day.blocks.forEach(block => {
                            html += `
                                <div style="margin-left: 16px; margin-bottom: 12px; padding: 12px; background: #fafafa; border-radius: 6px;">
                                    <strong>${block.label} ${block.time || ''}</strong><br>
                                    <div style="color: #666; font-size: 14px;">${block.description || ''}</div>
                                </div>
                            `;
                        });
                    }
                    
                    html += `</div>`;
                });
            }

            if (data.tips && data.tips.length > 0) {
                html += `<h3>üí° Travel Tips</h3><div class="time-slot">`;
                data.tips.forEach(tip => {
                    html += `<div style="margin-bottom: 8px;">‚Ä¢ ${tip}</div>`;
                });
                html += `</div>`;
            }

            uiContent.innerHTML = html;
            document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
            showResult();
        }

        async function testInteractivePlan() {
            const prompt = document.getElementById('interactivePrompt').value;
            const language = document.getElementById('interactiveLanguage').value;
            const currency = document.getElementById('interactiveCurrency').value;

            if (!prompt) {
                alert('L√ºtfen bir prompt girin!');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/plan/interactive`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt, language, currency })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'API error');
                }

                displayInteractivePlan(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        function displaySimplePlan(data) {
            const uiContent = document.getElementById('uiContent');
            
            let html = `
                <div class="success">‚úÖ Plan ba≈üarƒ±yla olu≈üturuldu!</div>
                
                <h3>üìä √ñzet</h3>
                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; line-height: 1.6;">${data.summary || 'Plan olu≈üturuldu.'}</p>
                </div>

                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${data.query?.parsed?.nights || '?'}</div>
                        <div class="stat-label">Gece</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.days?.length || '?'}</div>
                        <div class="stat-label">G√ºn</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.query?.parsed?.adults || '?'}</div>
                        <div class="stat-label">Ki≈üi</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.pricing?.totalEstimated?.toFixed(0) || 'N/A'}</div>
                        <div class="stat-label">${data.pricing?.currency || 'TRY'}</div>
                    </div>
                </div>
            `;

            // Flights
            if (data.flights?.outbound) {
                const flight = data.flights.outbound;
                const segment = flight.segments?.[0];
                html += `
                    <h3>‚úàÔ∏è Gidi≈ü U√ßu≈üu</h3>
                    <div class="time-slot">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div>
                                <strong>${segment?.airline} ${segment?.flightNumber}</strong>
                                <div style="color: #666; font-size: 13px; margin-top: 4px;">
                                    ${segment?.fromIata} ‚Üí ${segment?.toIata}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 20px; font-weight: 700; color: #667eea;">
                                    ${flight.price?.toFixed(0)} ${flight.currency}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    ${Math.floor(segment?.durationMinutes / 60)}h ${segment?.durationMinutes % 60}m
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 13px; color: #666;">
                            ${segment?.departISO ? new Date(segment.departISO).toLocaleString('tr-TR') : ''} ‚Üí 
                            ${segment?.arriveISO ? new Date(segment.arriveISO).toLocaleString('tr-TR') : ''}
                        </div>
                        ${flight.bookingUrl ? `<a href="${flight.bookingUrl}" target="_blank" style="display: inline-block; margin-top: 8px; color: #667eea;">Rezervasyon Yap ‚Üí</a>` : ''}
                    </div>
                `;

                // Alternative flights
                if (data.flights.alternatives?.length > 0) {
                    html += `<h3>üîÑ Alternatif U√ßu≈ülar</h3>`;
                    data.flights.alternatives.slice(0, 3).forEach(alt => {
                        const seg = alt.segments?.[0];
                        html += `
                            <div class="option" style="margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span><strong>${seg?.airline} ${seg?.flightNumber}</strong> - ${seg?.fromIata} ‚Üí ${seg?.toIata}</span>
                                    <span style="color: #667eea; font-weight: 600;">${alt.price?.toFixed(0)} ${alt.currency}</span>
                                </div>
                                <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                    ${seg?.departISO ? new Date(seg.departISO).toLocaleTimeString('tr-TR') : ''} - 
                                    ${Math.floor(seg?.durationMinutes / 60)}h ${seg?.durationMinutes % 60}m
                                </div>
                            </div>
                        `;
                    });
                }
            }

            // Days/Itinerary
            if (data.days && data.days.length > 0) {
                html += `<h3>üìÖ G√ºnl√ºk Program</h3>`;
                data.days.forEach((day, idx) => {
                    if (day.blocks && day.blocks.length > 0) {
                        html += `
                            <div class="time-slot">
                                <div class="time-slot-header">
                                    <span>G√ºn ${idx + 1}: ${day.title || ''}</span>
                                    <span class="day-badge">${day.dateISO ? new Date(day.dateISO).toLocaleDateString('tr-TR') : ''}</span>
                                </div>
                                <div style="color: #666; font-size: 14px; margin-bottom: 12px;">${day.description || ''}</div>
                        `;
                        
                        day.blocks.forEach(block => {
                            html += `
                                <div style="margin-left: 16px; margin-bottom: 8px;">
                                    <strong>${block.label}</strong> ${block.time || ''}
                                    <div style="color: #666; font-size: 13px;">${block.description || ''}</div>
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                    } else {
                        html += `
                            <div class="time-slot">
                                <div class="time-slot-header">
                                    <span>G√ºn ${idx + 1}</span>
                                </div>
                                <div style="color: #999; font-style: italic;">Detaylƒ± program olu≈üturuluyor...</div>
                            </div>
                        `;
                    }
                });
            }

            // Warnings
            if (data.metadata?.warnings?.length > 0) {
                html += `<h3>‚ö†Ô∏è √ñnemli Notlar</h3>`;
                html += `<div class="time-slot">`;
                data.metadata.warnings.forEach(warning => {
                    html += `<div style="margin-bottom: 8px;">‚Ä¢ ${warning}</div>`;
                });
                html += `</div>`;
            }

            // Pricing Breakdown
            if (data.pricing?.breakdown) {
                html += `<h3>üí∞ Fiyat Detayƒ±</h3>`;
                html += `<div class="time-slot">`;
                const b = data.pricing.breakdown;
                if (b.flights) html += `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>U√ßu≈ü</span><span>${b.flights?.toFixed(0)} ${data.pricing.currency}</span></div>`;
                if (b.lodging) html += `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>Konaklama</span><span>${b.lodging?.toFixed(0)} ${data.pricing.currency}</span></div>`;
                if (b.activities) html += `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>Aktiviteler</span><span>${b.activities?.toFixed(0)} ${data.pricing.currency}</span></div>`;
                if (b.transport) html += `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>Ula≈üƒ±m</span><span>${b.transport?.toFixed(0)} ${data.pricing.currency}</span></div>`;
                html += `</div>`;
            }

            uiContent.innerHTML = html;
            document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
            showResult();
        }

        function displayInteractivePlan(data) {
            const uiContent = document.getElementById('uiContent');
            
            let html = `
                <div class="success">‚úÖ Interactive plan ba≈üarƒ±yla olu≈üturuldu!</div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${data.total_days || '?'}</div>
                        <div class="stat-label">G√ºn</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.time_slots?.length || '?'}</div>
                        <div class="stat-label">Time Slots</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.destination || '?'}</div>
                        <div class="stat-label">Hedef</div>
                    </div>
                </div>
                <h3>‚è∞ Time Slots (Frontend Format)</h3>
            `;

            if (data.time_slots) {
                data.time_slots.forEach(slot => {
                    html += `
                        <div class="time-slot">
                            <div class="time-slot-header">
                                <span>G√ºn ${slot.day} | ${slot.startTime} - ${slot.endTime}</span>
                                <span class="day-badge">${slot.block_type || ''}</span>
                            </div>
                            <div class="options">
                    `;

                    slot.options?.forEach((option, idx) => {
                        html += `
                            <div class="option">
                                <div class="option-text">üéØ Se√ßenek ${idx + 1}: ${option.text}</div>
                                <div class="option-desc">${option.description}</div>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                });
            }

            uiContent.innerHTML = html;
            document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
            showResult();
        }

        function displayError(message) {
            const uiContent = document.getElementById('uiContent');
            uiContent.innerHTML = `<div class="error">‚ùå Error: ${message}</div>`;
            document.getElementById('jsonContent').textContent = message;
            showResult();
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
            document.getElementById('result').classList.remove('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        function showResult() {
            document.getElementById('result').classList.add('active');
        }
    </script>
</body>
</html>
